# Простейшая подготовка к настройке сетевого фильтра
# Подразумевается, наличие в системе пакетов:iptables,iptables-save.
# 

#0.
[root@slinux ~]# mkdir -p /etc/sysconfig/_iptables
[root@slinux ~]# cd /etc/sysconfig/_iptables
[root@slinux _iptables]# pwd
/etc/sysconfig/_iptables
[root@slinux _iptables]# touch _1-IPT-flash-script.sh && chmod +x _1-IPT-flash-script.sh
[root@slinux _iptables]# touch _2-IPT-base-script.sh && chmod +x _2-IPT-base-script.sh
[root@slinux _iptables]# touch _3-IPT-setup-script.sh && chmod +x _3-IPT-setup-script.sh
[root@slinux _iptables]# touch _4-IPT-debug-stateful-script.sh && chmod +x _4-IPT-debug-stateful-script.sh
[root@slinux _iptables]# touch _5-IPT-debug-stateless-script.sh && chmod +x _5-IPT-debug-stateless-script.sh
[root@slinux _iptables]# touch _6-IPT-debug-server-services-script.sh && chmod +x _6-IPT-debug-server-services-script.sh

[root@slinux _iptables]# ls -la
итого 16
drwxr-xr-x 2 root root 4096 мая 18 18:33 .
drwxr-xr-x 6 root root 4096 мая 17 23:16 ..
-rwxr-xr-x 1 root root  995 мая 18 11:46 _1-IPT-flash-script.sh
-rwxr-xr-x 1 root root 1713 мая 18 11:46 _2-IPT-base-script.sh
-rwxr-xr-x 1 root root    0 мая 17 23:19 _3-IPT-setup-script.sh
-rwxr-xr-x 1 root root    0 мая 18 18:33 _4-IPT-debug-stateful-script.sh
-rwxr-xr-x 1 root root    0 мая 18 18:33 _5-IPT-debug-stateless-script.sh
-rwxr-xr-x 1 root root    0 мая 18 18:33 _6-IPT-debug-server-services-script.sh
[root@slinux _iptables]# 

#1. 
cat > _1-IPT-flash-script.sh <<<'!/bin/bash
#======================================================================================================================
# Flash all chains and rules and setup ACCEPT ALL policies
#======================================================================================================================
#
# Reset All Rules
#
iptables -F
iptables -X
iptables -Z
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -t raw -F
iptables -t raw -X
iptables --flush
iptables --table nat --flush
iptables --delete-chain
iptables --table nat --delete-chain
#
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
#======================================================================================================================
echo "Firewall completely stopped! WARNING: THIS HOST HAS NO FIREWALL RUNNING!"
#======================================================================================================================
'

=TO THIS LINE==========================================================================================================

#2.
cat > _2-IPT-base-script.sh <<<'!/bin/bash
#======================================================================================================================
# Simple rules for basic iptables setup.
#======================================================================================================================

iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT

iptables -A INPUT -p ALL -i lo --source 127.0.0.1 --destination 127.0.0.1 -j ACCEPT
iptables -A OUTPUT -p ALL -o lo --source 127.0.0.1 --destination 127.0.0.1 -j ACCEPT

iptables -A INPUT -p tcp -i enp0s9 --dport 22 --source 192.168.192.100 --destination 192.168.92.105 -j ACCEPT
iptables -A OUTPUT -p tcp -o enp0s9 --sport 22 --source 192.168.92.105 --destination 192.168.192.100 -j ACCEPT

iptables -t nat -A POSTROUTING -s 192.168.120.0/24 -d 0/0 -o enp0s9 -j SNAT --to-source 192.168.92.105
iptables -t nat -A POSTROUTING -s 192.168.110.0/24 -d 0/0 -o enp0s9 -j SNAT --to-source 192.168.92.105

iptables -A FORWARD -i enp0s8 -o enp0s9 -s 192.168.120.0/24 -j ACCEPT
iptables -A FORWARD -i enp0s10 -o enp0s9 -s 192.168.110.0/24 -j ACCEPT

iptables -A FORWARD -i enp0s9 -o enp0s8 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i enp0s9 -o enp0s10 -m state --state ESTABLISHED,RELATED -j ACCEPT
#======================================================================================================================
echo "Firewall works with simple rules! WARNING: BE CAREFUL!"
#======================================================================================================================
'

=TO THIS LINE==========================================================================================================

#3.
